# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## What This Repo Is

A **reusable development environment generator** for multi-repo OpenShift development. It provides:
- A preset system for bootstrapping dev environments (`presets/`)
- A setup script for cloning and managing repositories (`setup.sh`)
- Project workspaces for structured task tracking (`projects/`)
- Claude Code skills for common workflows (`.claude/skills/`)

All source repositories are cloned into the `repos/` folder. Use `/dev-env setup` to initialize from a preset, or create a custom `dev-env.yaml`.

## Source of Truth Priority

**IMPORTANT**: When answering questions or implementing changes:
1. **Always look at repos in this workspace FIRST** before using internal knowledge or web searches
2. If a component has a repo here, that repo is the **authoritative source of truth**
3. Code in `repos/` reflects the latest development state, which may differ from public documentation

## Fork Model

All repositories use a fork model for contributions:
- Push changes to your personal fork first, not directly to upstream
- Create pull requests from your fork to the upstream repository

## Repository Table

<!-- AUTO-GENERATED by /dev-env setup — do not edit manually -->
<!-- To regenerate, run /dev-env setup or update dev-env.yaml and re-run the skill -->

| Name | Category | Summary |
|------|----------|---------|
| `enhancements` | docs | Enhancement proposals — contains the authoritative TNF design spec |
| `api` | development | API types, FeatureGates (DualReplica), PacemakerCluster CRD |
| `assisted-service` | development | Assisted Installer service — TNF cluster installation via MCE/ACM |
| `cluster-etcd-operator` | development | etcd operator — THE heart of TNF (Pacemaker init, fencing, etcd handover) |
| `machine-config-operator` | development | OS config — installs HA packages, creates dirs, enables PCSD (Day 1) |
| `installer` | development | OpenShift installer — standalone Agent-Based Installation with fencing |
| `cluster-baremetal-operator` | development | Bare metal provisioning — must avoid power-management conflicts with Pacemaker |
| `resource-agents` | development | OCF resource agents — contains podman-etcd agent for Pacemaker-managed etcd |
| `pacemaker` | troubleshooting | Upstream HA cluster manager — reference only for debugging |
| `openshift-docs` | docs | Official OpenShift documentation (AsciiDoc) — TNF install/operation guides |
| `dev-scripts` | development | Dev/test environment scripts — libvirt VMs with virtualbmc for TNF clusters |
| `two-node-toolbox` | deployment | THE go-to deployment tool — wraps dev-scripts, AWS provisioning, cluster lifecycle |
| `origin` | testing | E2E test suite — TNF topology, recovery, node replacement, degraded mode tests |
| `release` | testing | CI/CD configuration — Prow jobs, step registry workflows for TNF scenarios |

## Skills

| Skill | Usage | Description |
|-------|-------|-------------|
| `/dev-env setup` | Initialize or refresh dev environment | Set up from preset or custom repos |
| `/project new` | Create a new project workspace | Structured workspace for a specific task |
| `/project resume` | Resume an existing project | Reload context and continue work |

## Preset Docs

For architecture details, debugging commands, and domain concepts, see the active preset's docs:
- `presets/tnf/docs/architecture.md` — TNF architecture diagram, key concepts, failure scenarios
- `presets/tnf/docs/debugging.md` — Pacemaker, etcd, and cluster diagnostic commands
- `presets/tnf/context/<repo>.md` — Per-repo TNF-specific context (loaded on demand)
